

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Logical IDs &mdash; AWS Cloud Development Kit</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Environments and Authentication" href="environments.html" />
    <link rel="prev" title="Stacks" href="stacks.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> AWS Cloud Development Kit
          

          
          </a>

          
            
            
              <div class="version">
                0.8.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="concepts.html">Concepts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="constructs.html">Constructs</a></li>
<li class="toctree-l2"><a class="reference internal" href="stacks.html">Stacks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Logical IDs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#renaming-logical-ids">Renaming Logical IDs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="environments.html">Environments and Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="apps.html">Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="context.html">Environmental Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="assets.html">Assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="applets.html">Applets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aws-construct-lib.html">AWS Construct Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloudformation.html">AWS CloudFormation Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AWS Cloud Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="concepts.html">AWS CDK Concepts</a> &raquo;</li>
        
      <li>Logical IDs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/logical-ids.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="logical-ids">
<span id="id1"></span><h1>Logical IDs<a class="headerlink" href="#logical-ids" title="Permalink to this headline">¬∂</a></h1>
<p>When you synthesize a stack into an AWS CloudFormation template,
the AWS CDK assigns a
<a class="reference external" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resources-section-structure.html">logical ID</a>,
which must be unique within the template,
to each resource in the stack.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When you update the template, AWS CloudFormation uses these logical IDs to plan the update
and apply changes. Therefore, logical IDs must remain ‚Äústable‚Äù across updates.
If you make a modification in your code that results in a change to a logical ID
of a resource, AWS CloudFormation deletes the resource and creates a new resource when it
updates the stack.</p>
</div>
<p>Each resource in the construct tree has a unique path that represents its
location within the tree.
Since logical IDs can only use alphanumeric characters and also restricted in
length, the CDK is unable to simply use a delimited path as the logical ID.
Instead, logical IDs are allocated by concatenating a human-friendly rendition
from the path (concatenation, de-duplicate, trim) with an eight-character MD5
hash of the delimited path.
This final component is necessary since AWS CloudFormation logical IDs cannot include
the delimiting slash character (/), so simply concatenating the component
values does not work. For example, concatenating the components of the
path <em>/a/b/c</em> produces <strong>abc</strong>, which is the same as concatenating the components of
the path <em>/ab/c</em>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>VPCPrivateSubnet2RouteTable0A19E10E
&lt;-----------human---------&gt;&lt;-hash-&gt;
</pre></div>
</div>
<p>Low-level CloudFormation resources (from <cite>&#64;aws-cdk/resources</cite>)
that are direct children of the <a class="reference internal" href="refs/_aws-cdk_cdk.html#&#64;aws-cdk/cdk.Stack" title="&#64;aws-cdk/cdk.Stack"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stack</span></code></a> class use
their name as their logical ID without modification. This makes it easier to
port existing templates into a CDK app.</p>
<p>This scheme ensures that:</p>
<dl class="docutils">
<dt>Logical IDs have a human-friendly portion</dt>
<dd>This is useful when interacting directly with the synthesized AWS CloudFormation
template during development and deployment.</dd>
<dt>Logical IDs are unique within the stack</dt>
<dd>This is ensured by the MD5 component,
which is based on the absolute path to the resource,
which is unique within a stack.</dd>
<dt>Logical IDs remain unchanged across updates</dt>
<dd>This is true as long as their location within the construct tree doesn‚Äôt change.</dd>
</dl>
<p>The AWS CDK applies some heuristics to improve the human-friendliness of the prefix:</p>
<ul class="simple">
<li>If a path component is <strong>Default</strong>, is is hidden completely from the logical ID
computation. You will generally want to use this if you create a new construct
that wraps an existing one. By naming the inner construct <strong>Default</strong>, you
ensure that the logical identifiers of resources in already-deployed copy of
that construct do not change.</li>
<li>If a path component is <strong>Resource</strong>, it is omitted from the human readable portion.
of the logical ID. This postfix does not normally contribute any additional useful information to the ID.</li>
<li>If two subsequent names in the path are the same, only one is retained.</li>
<li>If the prefix exceeds 240 characters, it is trimmed to 240 characters.
This ensures that the total length of the logical ID does not exceed the 255 character
AWS CloudFormation limit for logical IDs.</li>
</ul>
<div class="section" id="renaming-logical-ids">
<span id="changing-logical-ids"></span><h2>Renaming Logical IDs<a class="headerlink" href="#renaming-logical-ids" title="Permalink to this headline">¬∂</a></h2>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">aws-cdk.Stack.renameLogical()</span></code> method can be used to explicitly assign
logical IDs to certain resources, given either their full path or</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">MyStack</span> <span class="kr">extends</span> <span class="nx">Stack</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">parent</span><span class="o">:</span> <span class="nx">App</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">props</span><span class="o">:</span> <span class="nx">StackProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>

    <span class="c1">// note that `renameLogical` must be called /before/ defining the construct.</span>
    <span class="c1">// a good practice would be to always put these at the top of your stack initializer.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">renameLogical</span><span class="p">(</span><span class="s1">&#39;MyTableCD117FA1&#39;</span><span class="p">,</span> <span class="s1">&#39;MyTable&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">renameLogical</span><span class="p">(</span><span class="s1">&#39;MyQueueAB4432A3&#39;</span><span class="p">,</span> <span class="s1">&#39;MyAwesomeQueue&#39;</span><span class="p">);</span>

    <span class="k">new</span> <span class="nx">Table</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;MyTable&#39;</span><span class="p">);</span>
    <span class="k">new</span> <span class="nx">Queue</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;MyQueue&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In some cases changing a resource
results in a structural change,
which results in a different path,
thus changing the logical ID of the resource.</p>
<p>When a resource‚Äôs logical ID changes,
AWS CloudFormation eventually deletes the old resource and create a new resource,
as it cannot determine that the two resources are the same.
Depending on the nature of the resource,
this can be disastrous in production, such as when deleting a DynamoDB table.</p>
<p>You could use
<a class="reference external" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html">AWS CloudFormation Stack Policies</a>
to protect critical resources in your stack from accidental deletion.
Although this AWS CloudFormation feature is not supported in the AWS CDK and AWS CDK Toolkit,
the AWS CDK does provide a few other mechanisms to help deal with logical ID changes.</p>
<p>If you have CDK stacks deployed with persistent resources such as S3 buckets or
DynamoDB tables, you might want to explicitly ‚Äúrename‚Äù the new logical IDs to
match your existing resources.</p>
<p>First, make sure you compare the newly synthesized template with any deployed
stacks. <cite>cdk diff</cite> will tell you which resources are about to be destroyed:</p>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span>[-] ‚ò¢Ô∏è Destroying MyTable (type: AWS::DynamoDB::Table)
[+] üÜï Creating MyTableCD117FA1 (type: AWS::DynamoDB::Table)
</pre></div>
</div>
<p>Now, you can add a <code class="xref py py-meth docutils literal notranslate"><span class="pre">aws-cdk.Stack.renameLogical()</span></code> call before the
table is defined to rename <strong>MyTableCD117FA1</strong> to <strong>MyTable</strong>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="environments.html" class="btn btn-neutral float-right" title="Environments and Authentication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="stacks.html" class="btn btn-neutral" title="Stacks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Amazon Web Services.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.8.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>